# Tasks Document

- [x] 1.1 Add init_platform function to api.rs
  - File: `rust/src/api.rs`
  - Add platform initialization function with Android-specific btleplug init
  - Use cfg attributes for conditional compilation
  - Purpose: Enable BLE on Android by initializing btleplug correctly
  - _Leverage: existing init_logging pattern in api.rs_
  - _Requirements: 1, 2_
  - _Prompt: Implement the task for spec android-ble-init, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Rust FFI developer with Android JNI experience | Task: Add init_platform() function to api.rs that calls btleplug::platform::init() on Android using cfg(target_os = "android"). Follow the pattern of init_logging and init_panic_handler. The function should be callable from Flutter and return Result<()>. | Restrictions: Only modify api.rs, do not change adapter code, use cfg attributes not runtime checks | Success: Function compiles for all targets, Android build includes btleplug init call, other platforms get no-op | After implementation: Mark task [-] as in_progress before starting, use log-implementation tool to record changes, then mark [x] when complete_

- [x] 1.2 Update Flutter main.dart to call init_platform
  - File: `lib/main.dart`
  - Call init_platform() after RustLib.init() but before any BLE operations
  - Add error handling for initialization failure
  - Purpose: Ensure Android BLE is initialized before app uses BLE
  - _Leverage: existing main.dart initialization pattern_
  - _Requirements: 1, 2_
  - _Prompt: Implement the task for spec android-ble-init, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter developer with FFI experience | Task: Update main.dart to call initPlatform() (generated by FRB from init_platform) after RustLib.init(). Add try-catch for graceful error handling. Log any initialization errors. | Restrictions: Keep changes minimal, do not reorganize existing code | Success: App starts without BLE init error on Android, graceful error on failure | After implementation: Mark task [-] as in_progress before starting, use log-implementation tool to record changes, then mark [x] when complete_

- [-] 1.3 Test BLE scanning on Android device
  - File: N/A (manual testing)
  - Rebuild APK and install on Pixel 9a
  - Verify BLE scan finds Coospo HW9 device
  - Purpose: Validate fix works on real hardware
  - _Leverage: scripts/adb-install.sh (once created)_
  - _Requirements: 1_
  - _Prompt: Implement the task for spec android-ble-init, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Rebuild the Android APK using build-android.sh, install on connected Pixel 9a, launch app and test BLE scanning. Verify the "droidplug has not been initialized" error no longer appears and devices are discovered. | Restrictions: Test on real device, not emulator (BLE doesn't work on emulator) | Success: BLE scan completes without error, nearby HR monitors appear in list | After implementation: Mark task [-] as in_progress before starting, use log-implementation tool to record changes, then mark [x] when complete_
